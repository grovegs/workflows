name: ğŸš€ Release

on:
    workflow_dispatch:
        inputs:
            version-type:
                description: "Select the version to increment (major, minor, patch)."
                required: true
                default: "patch"
                type: choice
                options:
                    - major
                    - minor
                    - patch

permissions:
    contents: write

jobs:
    shared:
        runs-on: ubuntu-latest
        outputs:
            version: ${{ steps.bump_version.outputs.next-version }}
            changelog-raw: ${{ steps.generate_changelog.outputs.changelog-raw }}
            changelog-markdown: ${{ steps.generate_changelog.outputs.changelog-markdown }}

        steps:
            - name: ğŸ“‚ Checkout Code
              uses: actions/checkout@v5
              with:
                  fetch-depth: 0

            - name: ğŸ†™ Bump Version
              id: bump_version
              uses: grovegs/actions/.github/actions/bump-version@v0.0.4
              with:
                  version-type: ${{ inputs.version-type }}

            - name: ğŸ“ Generate Changelog
              id: generate_changelog
              uses: grovegs/actions/.github/actions/generate-changelog@v0.0.4
              with:
                  next-version: ${{ steps.bump_version.outputs.next-version }}

    release_github:
        needs: [shared]
        runs-on: ubuntu-latest

        steps:
            - name: ğŸ“‚ Checkout Code
              uses: actions/checkout@v5

            - name: ğŸš€ Publish to Github
              uses: grovegs/actions/.github/actions/publish-github@v0.0.4
              with:
                  title: "Release v${{ needs.shared.outputs.version }}"
                  version: "v${{ needs.shared.outputs.version }}"
                  changelog: ${{ needs.shared.outputs.changelog-markdown }}
                  github-token: ${{ secrets.GITHUB_TOKEN }}
