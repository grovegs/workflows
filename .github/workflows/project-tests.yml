name: ðŸ§ª Test Project

on:
    workflow_call:
        inputs:
            runs-on:
                description: The type of runner to use (ubuntu-latest, macos-latest, or self-hosted label)
                required: false
                type: string
                default: "ubuntu-latest"
            dotnet-project:
                description: Path to the .NET test project containing the .csproj file such as "tests/Game.Tests"
                required: false
                type: string
                default: ""
            global-json-file:
                description: The relative path to the global.json file to extract .NET and Godot version
                required: false
                type: string
                default: ""
            godot-project:
                description: Path to the Godot project containing the project.godot file such as "projects/Game"
                required: false
                type: string
                default: ""
            unity-project:
                description: Path to the Unity project containing the ProjectSettings folder such as "projects/UnityGame"
                required: false
                type: string
                default: ""

jobs:
    test-dotnet:
        name: Test .NET
        if: inputs.dotnet-project != ''
        runs-on: ${{ inputs.runs-on }}

        steps:
            - name: ðŸ“‚ Checkout Code
              uses: actions/checkout@v6

            - name: ðŸ”§ Setup .NET
              uses: grovegs/actions/.github/actions/setup-dotnet@v1.0.23
              with:
                  global-json-file: ${{ inputs.global-json-file }}

            - name: ðŸ§ª Test .NET Project
              uses: grovegs/actions/.github/actions/test-dotnet@v1.0.23
              with:
                  project: ${{ inputs.dotnet-project }}
                  configuration: Release

    test-godot:
        name: Test Godot
        if: inputs.godot-project != ''
        runs-on: ${{ inputs.runs-on }}

        steps:
            - name: ðŸ“‚ Checkout Code
              uses: actions/checkout@v6

            - name: ðŸ”§ Setup .NET
              uses: grovegs/actions/.github/actions/setup-dotnet@v1.0.23
              with:
                  global-json-file: ${{ inputs.global-json-file }}

            - name: ðŸŽ® Setup Godot
              uses: grovegs/actions/.github/actions/setup-godot@v1.0.23
              with:
                  global-json-file: ${{ inputs.global-json-file }}

            - name: ðŸ§ª Test Godot Project
              uses: grovegs/actions/.github/actions/test-godot@v1.0.23
              with:
                  project: ${{ inputs.godot-project }}

    test-unity:
        name: Test Unity
        if: inputs.unity-project != ''
        runs-on: ${{ inputs.runs-on }}

        steps:
            - name: ðŸ“‚ Checkout Code
              uses: actions/checkout@v6

            - name: ðŸŽ® Setup Unity
              uses: grovegs/actions/.github/actions/setup-unity@v1.0.23
              with:
                  project: ${{ inputs.unity-project }}

            - name: ðŸ§ª Test Unity Project
              uses: grovegs/actions/.github/actions/test-unity@v1.0.23
              with:
                  project: ${{ inputs.unity-project }}
